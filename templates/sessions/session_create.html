<!-- https://mattstauffer.com/blog/a-little-trick-for-grouping-fields-in-an-html-form/ -->

{% extends "sessions/base.html" %}

{% block content %}
<form method="post" action="/sessions/add">
  <input type="hidden" name="workout_id" value="{{workout.id}}" />
  <div class="container d-flex justify-content-between mt-4 pt-4">
    <div>
      <button class='btn create-button'>Create session</button>
    </div>
    <div>
      <h1>{{workout.name}}</h1>
    </div>
  </div>

  <div class="container mt-4">
    <div class="row row-cols-3 gx-5 gy-4">
      {% for exercise in workout.exercises %}
      <div class="col">
        <div class="p-3 border border-secondary border-2 rounded-4" style="color:rgb(93, 93, 93); font-size:13px;">
          <div class="d-flex justify-content-between">
            <h4>{{loop.index}}</h4>
            <h4>{{exercise.name|title}}</h4>
            <div>
              <button type="button" class="btn btn-outline-secondary rounded-circle"
                onclick="add_new_set({{exercise.id}})">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg"
                  viewBox="0 0 16 16">
                  <path fill-rule="evenodd"
                    d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z" />
                </svg>
                <span class="visually-hidden">Button</span>
              </button>
            </div>
          </div>
          <table id="{{exercise.id}}" class="table text-center">
            <thead>
              <th scope="col">Weight</th>
              <th scope="col">Reps</th>
              <th scope="col">Time</th>
            </thead>
            <tbody id="sets_{{exercise.id}}">
              {% set outer_loop = loop %}
              {% if prev_session %}
              {% for set in prev_session.records[outer_loop.index - 1].sets %}
              <tr scope="row">
                <td><input placeholder="{{set.weight}}" type="number" step="0.1" class="form-control rounded-4"
                    name="records[{{exercise.id}}][weight]" required></td>
                <td><input placeholder="{{set.reps}}" type="number" step="0.1" class="form-control rounded-4"
                    name="records[{{exercise.id}}][reps]" required></td>
                <td><input placeholder="{{set.time}}" type="number" step="0.1" class="form-control rounded-4"
                    name="records[{{exercise.id}}][time]" required></td>
              </tr>
              {% endfor %}
              {% else %}
              <tr scope="row">
                <td><input type="number" step="0.1" class="form-control rounded-4"
                    name="records[{{exercise.id}}][weight]" required></td>
                <td><input type="number" step="0.1" class="form-control rounded-4"
                    name="records[{{exercise.id}}][reps]" required></td>
                <td><input type="number" step="0.1" class="form-control rounded-4"
                    name="records[{{exercise.id}}][time]" required></td>
              </tr>
              {% endif %}
            </tbody>
          </table>
          <div class="d-flex justify-content-end">
            <div>
              <button type="button" class="btn btn-outline-secondary rounded-circle"
                onclick="delete_last_set({{exercise.id}})">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-dash-lg"
                  viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M2 8a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11A.5.5 0 0 1 2 8Z" />
                </svg>
                <span class="visually-hidden">Button</span>
              </button>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</form>

<script>
  function add_new_set(exercise_id) {
    let template = `
      <tr scope="row">
        <td><input type="number" step="0.1" class="form-control rounded-4" name="records[${exercise_id}][weight]" required></td>
        <td><input type="number" step="0.1" class="form-control rounded-4" name="records[${exercise_id}][reps]" required></td>
        <td><input type="number" step="0.1" class="form-control rounded-4" name="records[${exercise_id}][time]" required></td>
      </tr>`;

    let container = document.getElementById('sets_' + exercise_id);
    let tr = document.createElement('tr');
    tr.innerHTML = template;
    container.appendChild(tr);
  }

  function delete_last_set(exercise_id) {
    var table = document.getElementById(exercise_id);
    var rowCount = table.rows.length;

    if (rowCount > 1) {
      table.deleteRow(rowCount - 1);
    }
  }
</script>
{% endblock %}